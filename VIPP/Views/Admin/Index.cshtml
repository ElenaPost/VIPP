@model IEnumerable<Microsoft.AspNet.Identity.EntityFramework.IdentityUser>

@{
    ViewBag.Title = "Каталог марафонов";
}

<div id="modDialog" class="modal fade">
    <div id="dialogContent" class="modal-dialog"></div>
</div>

<div class="form-group row pt-5">
    <div class="col-md-3 ml-md-auto">@Html.ActionLink("Назначить дату", "SetMarathonDate", null, null, new { @class = "showDialogContent btn-block btn btn-primary btn-sm", role = "button" })</div>
    <div class="col-md-3 ml-md-auto">@Html.ActionLink("Добавить марафон", "AddMarathon", null, null, new { @class = "showDialogContent btn-block btn btn-primary btn-sm", role = "button" })</div>
    <div class="col-md-3 ml-md-auto">@Html.ActionLink("Добавить участника", "AddParticipants", null, null, new { @class = "showDialogContent btn-block btn btn-primary btn-sm", role = "button" })</div>
    <div class="modal-footer row pr-md-0 btn-send btn-clear">
        <div class="col-md-offset-6 col-md-6 px-md-0">
            <button type="button" class="btn btn-primary btn-sm">Очистить данные о достижениях</button>
        </div>
    </div>
</div>

@section scripts
{
    <script type="text/javascript">

        $(function () {
            $.ajaxSetup({ cache: false });
            $(".showDialogContent").click(function (e) {

                e.preventDefault();
                $.get(this.href, function (data) {
                    $('#dialogContent').html(data);
                    $('#modDialog').modal('show');
                });
            });

            $("#modDialog").on('shown.bs.modal', function () {
                $(this).find('.first-field').focus;

                function highlightRequired(input) {
                    if (input.hasClass("required-empty") && input.val() != "") {
                        input.removeClass("required-empty");
                        input.next().removeClass("required-empty");
                    }
                }

                var form = $("button:contains('Добавить')").parents("form:first");

                $('input.required').change(function (event) {
                    highlightRequired($(this));
                });

                $("button:contains('Добавить')").on("click", function (e) {
                    e.preventDefault();
                    var inp = form.find("input.required");
                    var emptyInput = false;
                    for (var i = 0; i < inp.length; i++) {
                        var inpCurr = $(inp[i]);
                        if (inpCurr.val() == "") {
                            inpCurr.addClass("required-empty");
                            inpCurr.next().addClass("required-empty");
                            emptyInput = true;
                        }
                    }

                    if (!emptyInput) {
                        form.submit();
                    }
                });
            });

            $(".btn-clear").on("click", function (e) {
                e.preventDefault();
                $.ajax({
                    type: "POST",
                    url: "/Admin/ClearSelfEstimationCheckList"
                });
            });
        });
    </script>
}