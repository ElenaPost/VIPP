@model IEnumerable<Microsoft.AspNet.Identity.EntityFramework.IdentityUser>

@{
    ViewBag.Title = "Каталог марафонов";
}

<div id="modDialog" class="modal fade">
    <div id="dialogContent" class="modal-dialog"></div>
</div>

<div class="form-group row">
    <div class="col-md-3 ml-md-auto">@Html.ActionLink("Назначить дату", "SetMarathonDate", null, null, new { @class = "showDialogContent btn-block btn btn-primary btn-sm", role = "button" })</div>
    <div class="col-md-3 ml-md-auto">@Html.ActionLink("Добавить марафон", "AddMarathon", null, null, new { @class = "showDialogContent btn-block btn btn-primary btn-sm", role = "button" })</div>
</div>

@section scripts
{
    <script type="text/javascript">

        $(function () {
            $.ajaxSetup({ cache: false });
            $(".showDialogContent").click(function (e) {

                e.preventDefault();
                $.get(this.href, function (data) {
                    $('#dialogContent').html(data);
                    $('#modDialog').modal('show');
                });
            });

            $("#modDialog").on('shown.bs.modal', function () {
                $(this).find('.first-field').focus;

                function highlightRequired(input) {
                    if (input.hasClass("required-empty") && input.val() != "") {
                        input.removeClass("required-empty");
                        input.next().removeClass("required-empty");
                    }
                }

                var form = $("button:contains('Добавить')").parents("form:first");

                $('input.required').change(function (event) {
                    highlightRequired($(this));
                });

                $("button:contains('Добавить')").on("click", function (e) {
                    e.preventDefault();
                    var inp = form.find("input.required");
                    var emptyInput = false;
                    for (var i = 0; i < inp.length; i++) {
                        var inpCurr = $(inp[i]);
                        if (inpCurr.val() == "") {
                            inpCurr.addClass("required-empty");
                            inpCurr.next().addClass("required-empty");
                            emptyInput = true;
                        }
                    }

                    if (!emptyInput) {
                        form.submit();
                    }
                });
            });
        });
    </script>
}